<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>CE賓果遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
    }
    td {
      width: 80px;
      height: 80px;
      border: 1px solid black;
      text-align: center;
      vertical-align: middle;
      font-size: 18px;
      cursor: pointer;
    }
    .selected {
      background-color: lightgreen;
    }
    .wrong {
      background-color: lightcoral;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

<h1>CE賓果遊戲</h1>

<table id="bingoBoard"></table>

<div id="questionArea" style="margin-top: 20px; display:none;"></div>

<div id="status" style="margin-top: 20px;"></div>

<script>
// 這裡是完整題庫，現在只放1題作範例，要記得擴充成40題
let allQuestions = [
  {
    "題號": 1,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 2,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 3,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 4,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 5,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 6,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 7,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 8,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 9,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 10,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 11,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 12,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 13,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 14,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 15,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 16,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 17,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 18,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 19,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 202,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 21,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 22,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 23,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 24,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 25,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 26,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 27,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 28,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 29,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 30,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 31,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 32,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 33,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 34,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 35,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 36,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 37,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 38,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 39,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
  {
    "題號": 40,
    "題目內容": "電壓的單位是什麼？",
    "A": "安培",
    "B": "伏特",
    "C": "歐姆",
    "D": "瓦特",
    "正確答案": "B"
  },
];

let selectedCells = new Set();
let startTime = null;
let selectedNumbers = [];

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function initBingo() {
  const board = document.getElementById('bingoBoard');
  board.innerHTML = '';

  if (allQuestions.length < 25) {
    alert("題庫至少要25題！");
    return;
  }

  selectedNumbers = shuffle(allQuestions.map(q => q['題號'])).slice(0, 25);

  for (let i = 0; i < 5; i++) {
    const row = document.createElement('tr');
    for (let j = 0; j < 5; j++) {
      const idx = i * 5 + j;
      const cell = document.createElement('td');
      cell.innerText = selectedNumbers[idx];
      cell.dataset.index = selectedNumbers[idx];
      cell.addEventListener('click', () => showQuestion(cell, selectedNumbers[idx]));
      row.appendChild(cell);
    }
    board.appendChild(row);
  }
}

function showQuestion(cell, number) {
  if (startTime === null) startTime = Date.now();
  if (cell.classList.contains('selected') || cell.classList.contains('wrong')) return;

  const question = allQuestions.find(q => q['題號'] == number);
  if (!question) {
    alert("這個題目還沒設定！");
    return;
  }

  const questionDiv = document.getElementById('questionArea');
  questionDiv.innerHTML = `
    <h3>第${number}題：${question['題目內容']}</h3>
    ${['A', 'B', 'C', 'D'].map(opt => `
      <label><input type="radio" name="opt" value="${opt}"> ${opt}. ${question[opt]}</label><br>
    `).join('')}
    <button onclick="submitAnswer(${number}, '${question['正確答案']}')">確定</button>
  `;
  questionDiv.style.display = 'block';
}

function submitAnswer(number, correct) {
  const selected = document.querySelector('input[name="opt"]:checked');
  if (!selected) return alert("請選擇一個答案！");

  const cells = document.querySelectorAll('td');
  const cell = [...cells].find(c => parseInt(c.innerText) === number);

  if (selected.value === correct) {
    cell.classList.add('selected');
    selectedCells.add(number);
  } else {
    cell.classList.add('wrong');
    cell.onclick = null;
  }

  document.getElementById('questionArea').style.display = 'none';
  checkWin();
}

function checkWin() {
  const cells = document.querySelectorAll('#bingoBoard td');
  const map = Array(5).fill(0).map(() => Array(5).fill(false));

  cells.forEach((cell, index) => {
    if (selectedCells.has(parseInt(cell.innerText))) {
      map[Math.floor(index / 5)][index % 5] = true;
    }
  });

  let count = 0;
  for (let i = 0; i < 5; i++) {
    if (map[i].every(Boolean)) count++;
    if (map.map(r => r[i]).every(Boolean)) count++;
  }
  if ([0,1,2,3,4].every(i => map[i][i])) count++;
  if ([0,1,2,3,4].every(i => map[i][4-i])) count++;

  document.getElementById('status').innerText = `目前完成 ${count} 條線`;

  if (count >= 3) {
    const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
    alert(`恭喜完成三條線！用時 ${elapsed} 秒`);
  }
}

document.addEventListener('DOMContentLoaded', initBingo);
</script>

</body>
</html>